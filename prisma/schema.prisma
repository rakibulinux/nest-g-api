generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String         @id @default(uuid())
  email           String         @unique
  name            String
  password        String
  role            UserRole       @default(customer)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  isEmailVerified Boolean        @default(false)
  reviews         Review[]
  profile         Profile?
  notifications   Notification[]
  orders          Order[]

  @@map("users")
}

model TokenWhiteList {
  id             String   @id @default(uuid())
  userId         String
  accessToken    String?
  refreshToken   String?
  refreshTokenId String?
  expiredAt      DateTime
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("tokens")
}

enum UserRole {
  admin
  customer
}

model Profile {
  id         String   @id @default(uuid()) // Unique profile ID
  username   String   @unique
  // Add other user profile fields (e.g., address, phone number, etc.)
  user       User     @relation(fields: [userId], references: [id])
  userId     String   @unique // relation scalar field (used in the `@relation` attribute above)
  bio        String?
  profileImg String?
  phoneNo    String?
  address    String?
  gender     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("profiles")
}

// Define the Product model
model Product {
  id           String              @id @default(uuid()) // Unique Product ID
  name         String // Product name
  description  String? // Product description
  price        Float // Product price
  category     Category            @relation(fields: [categoryId], references: [id]) // Product category
  availability ProductAvailability @default(available)
  isFeatured   Boolean             @default(false)
  image        String
  categoryId   String
  reviews      Review[]
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  @@map("products")
}

enum ProductAvailability {
  available
  upcoming
}

// Define the Category model
model Category {
  id        String    @id @default(uuid()) // Unique category ID
  name      String // Category name
  // Add other category-related fields if needed
  products  Product[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("categories")
}

model Order {
  id        String      @id @default(uuid())
  price     Decimal
  Products  Json[]
  status    OrderStatus @default(pending)
  intent_id String?     @unique
  user      User        @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@map("orders")
}

enum OrderStatus {
  pending
  delivered
}

// Define the Review model
model Review {
  id        String   @id @default(uuid()) // Unique review ID
  userId    String // Foreign key to User
  ProductId String // Foreign key to Product
  rating    Float // Rating given by the user
  comment   String? // User's review comment
  user      User     @relation(fields: [userId], references: [id])
  products  Product  @relation(fields: [ProductId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("reviews")
}

// Notification model for user notifications (optional) - Not Done
model Notification {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  content   String // Notification content
  type      String // Notification type (e.g., 'order', 'reminder', 'update')
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("notifications")
}
